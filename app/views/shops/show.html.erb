<div class="spnew">
  <div class="spnewMain">
    <div class="format_content">
    <h2 class="format-title">お店情報詳細</h2>
      <%= form_with(model: @shop, local: true) do |form| %>
        <div class="spnewMain_contents">
          <div id='map'></div>
            <div class="spnewMain_contents__content">
              <div class="spnewMain_contents__content__head">
                <div class="spnewMain__content__file">
                  <div class="spnewMain__content__file__up">
                    <div class="h3.sell__main__content__file__up__head">
                      <style>#map { height: 300px; width: 600px;}</style>
                      <script>
                        let map
                        let geocoder
                        const display = document.getElementById('display')

                        function initMap(){
                          geocoder = new google.maps.Geocoder()

                          map = new google.maps.Map(document.getElementById('map'), {
                            center: {lat: 35.681236, lng:139.767125},
                            zoom: 15,
                          });

                          marker = new google.maps.Marker({
                            position:  {lat: 35.681236, lng:139.767125},
                            map: map
                          });
                        }

                        function codeAddress(){
                          let inputAddress = document.getElementById('address').value;

                          geocoder.geocode( { 'address': inputAddress}, function(results, status) {
                            if (status == 'OK') {
                              map.setCenter(results[0].geometry.location);
                              let marker = new google.maps.Marker({
                                  map: map,
                                  position: results[0].geometry.location
                              });
                              display.textContent = "検索結果：" + results[ 0 ].geometry.location
                            } else {
                              alert('該当する結果がありませんでした：' + status);
                            }
                          });   
                        }
                      </script>
                      <script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyAD_hqgyKELzdJcgXRshABtsr5UZv3yKck&callback=initMap" async defer></script>
                      <span class="form-require">
                      </span>
                    </div>
                    <div class="spnewMain__content__form">
                      <strong>店名:</strong>
                      <%# <%= form.label :店名 %>
                      <span class="form-require"></span>
                      <%= @shop.name %>
                      <%# <%= form.text_field :name, placeholder: "名前は？" %>
                    </div>
                    <div class="spnewMain__content__form">
                      <strong>場所:</strong>
                      <%# <%= form.label :住所 %>
                      <span class="form-require"></span>
                      <%= @shop.address %>
                      <%# <%= form.text_field :address, placeholder: "場所を選び直す？"%> 
                    </div>
                    <div class="spnewMain__content__form">
                      <tr>
                        <th><%= form.label :所要時間 %></th>
                        <td><%= Arrivaltime.find(@shop.arrivaltime).time %></td>分
                      </tr>
                    </div>
                    <div class="spnewMain__content__form">
                      <tr>
                        <th><%= form.label :値段 %></th>
                        <td><%= Price.find(@shop.price).value %></td>円
                      </tr>  
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br>#タグ、#コスパ良し、#ワンコイン
        </div>
      <% end %>
    </div>
    <div class="back">
      <% if user_signed_in? && current_user.id == @shop.user_id %>
        <div class="backBox">
          <%= link_to '編集', edit_shop_path(@shop), class:"editBtn" %> |
          <%= link_to "削除", "/shops/#{@shop.id}", method: :delete %>
        </div>
        <% else %>
          <%= link_to '戻る', shops_path, class:"backBtn" %>
      <% end %>  
    </div>   
    <div class="commentBox">
      <% if current_user %>
        <%= form_with(model: [@shop, @comment], local: true) do |form| %>
          <%= form.label :コメントエリア %>
          <%= form.text_area :text, placeholder:"\n\n（任意、1000文字まで)\nランチに誘うのに使ってください", rows: "10", cols:"50" %>
          <%= form.submit 'コメントを送信する' %>
        <% end %>
      <% else %>
        <strong><p>※※※ コメントの投稿には新規登録/ログインが必要です ※※※</p></strong>
      <% end %>
      <div class="commentBox_area">
        <h4>＜コメント一覧＞</h4>
        <% if @comments %>
          <% @comments.each do |comment| %>
            <p>
              <strong><%= link_to comment.user.nickname, "/users/#{comment.user_id}" %>：</strong>
              <%= comment.text %>
            </p>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>